<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chess Game</title>
</head>

    <!--CSS Part Start-->
    <style>
        .chess_board {
            width: 500px;
            height: 500px;
            margin: auto;
            background-color: cyan;
            display: flex;
            flex-wrap: wrap;
        }

        .chess_board div {
            width: 12.5%;
            height: 12.5%;
            box-sizing: border-box;
        }

        img {
            width: 100%;
            height: 100%;
            box-sizing: border-box;
        }
    </style>
    <!--CSS Part End-->

    <!--JavaScript Part Start-->
    <script defer>
        document.addEventListener("DOMContentLoaded", function() {

            // Pawn class start
            class Pawn {
                constructor (pawnPosition) {
                    this.firstMove = true;
                    this.pawnPosition = pawnPosition;
                    this.upOrDown = "";
                }
                
                possibleMove(coordinates) {
                    
                    let xAxisValue = coordinates.substr(6, 1);
                    let yAxisValue = coordinates.substr(coordinates.length -1, 1);
                    let possibleMovements = [];

                    if (this.firstMove === true) {
                        this.firstMove = false;
                        possibleMovements.push(`.cell_${parseInt(xAxisValue)+1}_${yAxisValue}`);
                        possibleMovements.push(`.cell_${parseInt(xAxisValue)+2}_${yAxisValue}`);
                    } else {
                        if (parseInt(yAxisValue) <= 8) {
                            possibleMovements.push(`cell_${parseInt(xAxisValue) + 1}_${yAxisValue}`);
                        }
                    }
                    console.log(possibleMovements);
                    return possibleMovements;
                }

                updatePawnPosition(newCoordinates) {
                    this.pawnPosition = newCoordinates;
                }

                eat(piece) {

                }


            }
            // Pawn class end

            // possible moves calculate start
            function possibleMove(piece, coordinates) {
                let foundIdx = 0;
                let xAxisValue = coordinates.substr(6, 1);
                let yAxisValue = coordinates.substr(coordinates.length -1, 1);
                let possibleMoves = [];
                let pieceName = "";


                // white pawn movement
                if (piece.getAttribute('alt').includes("whitePawn")) {
                    foundIdx = whitePawnPieces.findIndex(function(cellNumber){return cellNumber.pawnPosition === `.cell_${xAxisValue}_${yAxisValue}`});
                    pieceName = "whitePawn";
                } else if (piece.getAttribute('alt').includes("blackPawn")) {
                    foundIdx = blackPawnPieces.findIndex(function(cellNumber){return cellNumber.pawnPosition === `.cell_${xAxisValue}_${yAxisValue}`});
                    pieceName = "blackPawn";
                }

                
                if (foundIdx !== 0) {
                    switch (pieceName){
                        case "whitePawn":
                            possibleMoves = whitePawnPieces[foundIdx].possibleMove(`.cell_${xAxisValue}_${yAxisValue}`);
                            break;
                        case "blackPawn":
                            possibleMoves = blackPawnPieces[foundIdx].possibleMove(`.cell_${xAxisValue}_${yAxisValue}`);
                            break;
                    }
                    
                }
                
                return possibleMoves;

            }
            // possible moves calculate end



            // updating pieces start
            function updateCoordinate(piece, prevCoordinate, coordinates) {
                let foundIdx = 0;
                let prev_xAxisValue = prevCoordinate.substr(6, 1);
                let prev_yAxisValue = prevCoordinate.substr(coordinates.length -1, 1);
                let new_xAxisValue = coordinates.substr(6, 1);
                let new_yAxisValue = coordinates.substr(coordinates.length -1, 1);
                let possibleMoves = [];
                let pieceName = "";
                
                // white pawn movement
                if (piece.getAttribute('alt').includes("whitePawn")) {
                    foundIdx = whitePawnPieces.findIndex(function(cellNumber){return cellNumber.pawnPosition === `.cell_${prev_xAxisValue}_${prev_yAxisValue}`});
                    pieceName = "whitePawn";
                } else if (piece.getAttribute('alt').includes("blackPawn")) {
                    foundIdx = blackPawnPieces.findIndex(function(cellNumber){return cellNumber.pawnPosition === `.cell_${xAxisValue}_${yAxisValue}`});
                    pieceName = "blackPawn";
                }

                if (foundIdx !== 0) {
                    switch (pieceName){
                        case "whitePawn":
                            whitePawnPieces[foundIdx].updatePawnPosition(`.cell_${new_xAxisValue}_${new_yAxisValue}`);
                            break;
                        case "blackPawn":
                            blackPawnPieces[foundIdx].updatePawnPosition(`.cell_${new_xAxisValue}_${new_yAxisValue}`);
                            break;
                    } // end of switch case
                } // end of if foundIdx !== 0
            }
            // updating pieces end


            // Variables Start
            const chess_board = document.querySelector(".chess_board");
            let boxes = 8;
            const chess_pieces = ["Rook", "Knight", "Bishop", "Queen", "King", "Bishop", "Knight", "Rook"];
            let tempNum = 1;
            let selectedPiece = null;
            let prevCoordinate = null;
            let whitePawnPieces = [];
            let blackPawnPieces = [];
            let possibleMoves = [];
            let foundIdx = 0;
            let turn = "";
            // Variables End

            turn = prompt("For the game to start Choose a color: ", `Please enter "black" or "white"`);

            for(let rowNum = 1; rowNum <= boxes; rowNum++){
                // start of row outer for loop

                // start of inner for loop
                for(let colNum = 1; colNum <= boxes; colNum++){
                    let newCell = document.createElement("div");
                

                    // Different colors
                    if ((rowNum +colNum) % 2 === 0) {
                        newCell.style.backgroundColor = "rgb(99, 70, 49)";
                        
                    } else {
                        newCell.style.backgroundColor = "antiquewhite";
                        
                    }
                    newCell.className = `cell_${rowNum}_${colNum}`;

                    // when clicked it shows where piece can move
                    newCell.setAttribute("onclick", `clicked(".cell_${rowNum}_${colNum}")`);

                    chess_board.appendChild(newCell);
                }// end of inner for loop
            
            } // end of row outer for loop

            // White and Black Pawn position
            
            for(let i = 1; i <= 8; i++){
                const whitePawnPosition = document.querySelector(`.cell_2_${i}`);
                whitePawnPosition.innerHTML = `<img src="./img/whitePawn.png" alt="whitePawn">`
                var whitePawn = new Pawn(`.cell_2_${i}`);
                whitePawnPieces.push(whitePawn);

                const blackPawnPosition = document.querySelector(`.cell_7_${i}`);
                blackPawnPosition.innerHTML = `<img src="./img/blackPawn.png" alt="blackPawn">`
                var blackPawn = new Pawn(`.cell_7_${i}`);
                blackPawnPieces.push(blackPawn);
            }


            // White and Black Rook Position
            chess_pieces.forEach((piece) => {
                const whitePosition = document.querySelector(`.cell_1_${tempNum}`);
                whitePosition.innerHTML = `<img src="./img/white${piece}.png" alt="white${piece}">`

                const blackPosition = document.querySelector(`.cell_8_${tempNum}`);
                blackPosition.innerHTML = `<img src="./img/black${piece}.png" alt="black${piece}">`
                tempNum++;
            });

            tempNum = 0;

            

            window.clicked = function(coordinateValue) {
                // selecting a coordinate
                const coordinate = document.querySelector(`${coordinateValue}`);

                // if the piece is selected
                if(selectedPiece) {
                    // if the movement place is empty
                    if (coordinate.innerHTML === "") {
                        
                        possibleMoves = possibleMove(selectedPiece, prevCoordinate);

                        if (possibleMoves.length > 0) {
                            possibleMoves.forEach((possibleMovement) => {
                                // if it matches with coordinate movement
                                if(possibleMovement === `${coordinateValue}`) {
                                    coordinate.appendChild(selectedPiece);
                                    updateCoordinate(selectedPiece, prevCoordinate, `${coordinateValue}`);

                                    switch (turn) {
                                        case "white":
                                            turn = "black";
                                            break;
                                        case "black":
                                            turn = "white";
                                            break;
                                    } // end of switch case statement
                                } // end of if it matches possible movements
                            }); // possible moves for each statement
                        }

                        selectedPiece = null;
                        
                    // if there is an enemy
                    } else {

                        // need something to add
                        selectedPiece = coordinate.querySelector("img");
                        
                        
                    }
                } else {
                    if(coordinate.querySelector("img")){
                        // if it is not selectedPiece, then selection 
                        selectedPiece = coordinate.querySelector("img");
                        if(!selectedPiece.getAttribute('alt').includes(turn)) {
                            selectedPiece = null;
                        } else {
                            prevCoordinate = `${coordinateValue}`;
                        }
                        
                    } // inner if image if statement
                } // outer else statement
            }
        });
        
        
        
        
        
    </script>
    <!--JavaScript Part End-->
<body>
    <div class="chess_board">

    </div>
</body>
</html>